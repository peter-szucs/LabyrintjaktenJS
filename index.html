<!DOCTYPE html>
<html>
    <head>
        <meta name="viewport" content="width-device-width, initial-scale = 1.0">
        <link rel="stylesheet" type="text/css" href="style.css">
    </head>
    <body>
        <img id="logga" src="Logga.png">
        <canvas id="bgCanvas" width="352" height="576"></canvas>
        <canvas id="pcCanvas" width="352" height="576"></canvas>
        <canvas id="wallCanvas" width="352" height="455"></canvas>
        <input type="button" id="upButton" class="button" onmousedown="playerUp=true" onmouseup="playerUp=false" value="Upp">
        <input type="button" id="leftButton" class="button" onmousedown="playerLeft=true" onmouseup="playerLeft=false" value=" V ">
        <input type="button" id="rightButton" class="button" onmousedown="playerRight=true" onmouseup="playerRight=false" value=" H ">
        <input type="button" id="downButton" class="button" onmousedown="playerDown=true" onmouseup="playerDown=false" value="Ner">
        <script>
            //window.onload = function() {
                var loop = true;
                var wallCanvas = document.getElementById('wallCanvas');
                var pcCanvas = document.getElementById('pcCanvas');
                var bgCanvas = document.getElementById('bgCanvas');
                var ctxWalls = wallCanvas.getContext('2d');
                var ctxPc = pcCanvas.getContext('2d');
                var ctxBg = bgCanvas.getContext('2d');
                var allowedPathX = [];
                var allowedPathY = [];
                var walls = [];
                var gameTiles = 32;
                var mapArray = [
                    [5, 1, 9,  1, 1,  1, 1, 1, 1, 1, 6],
                    [3, 0, 14, 0, 0,  0, 0, 0, 0, 0, 4],
                    [3, 0, 14, 0, 16, 0, 26,13,13,13,12],
                    [3, 0, 15, 0, 14, 0, 14,0, 0, 0, 4],
                    [3, 0, 0,  0, 14, 0, 15,0, 18,13,12],
                    [11,13,13, 13,24, 0, 0, 0, 0, 0, 4],
                    [3, 0, 0,  0, 0,  0, 26,13,25,0, 4],
                    [3, 0, 26, 13,13,13, 24,0, 14,0, 4],
                    [3, 0, 15, 0, 0,  0, 0, 0, 23,13,12],
                    [3, 0, 0,  0, 16, 0, 16,0, 0, 0, 4],
                    [11,13,13, 13,21, 0, 23,13,13,13,12],
                    [3, 0, 0,  0, 14, 0, 0, 0, 0, 0, 0],
                    [3, 0, 16, 0, 14, 0, 18,13,25,0, 4],
                    [3, 0, 14, 0, 15, 0, 0, 0, 14,0, 4],
                    [3, 0, 14, 0, 0,  0, 16,0, 14,0, 4],
                    [3, 0, 23, 13,13, 13,20,13,24,0, 4],
                    [3, 0, 0,  0, 0,  0, 0, 0, 0, 0, 4],
                    [8, 2, 2,  2, 2,  2, 2, 2, 2, 2, 7]
                ];
                var tileSheet = new Image();
                var playerChar = new Image();
                var monsterChar1 = new Image();
                
                tileSheet.src = "Tilesheet.png";
                playerChar.src = 'pcDown.png';
                monsterChar1.src = 'Monster1.png'

                tileSheet.onload = function() {
                    draw();
                };
                playerChar.onload = function() {
                    ctxPc.drawImage(playerChar, 100, 68, 32, 41);
                }
                function draw() {
                    var posX = 0;
                    var posY = 0;
                    for (var i = 0; i < mapArray.length; i++) {
                        for (var j = 0; j < mapArray[i].length; j++) {
                            var value = mapArray[i][j];
                            var sourceX = (value % 6) * 32;
                            var sourceY = Math.floor(value / 6) * 32;
                            ctxBg.drawImage(tileSheet, sourceX, sourceY, 32, 32, posX, posY, 32, 32);
                            if (value == 0) {
                                allowedPathX.push(posX);
                                allowedPathY.push(posY);
                            }
                            if (value != 0) {
                                walls.push(posX, posY);
                            }
                            posX += 32;
                        }
                        posX = 0;
                        posY += 32;
                    }
                }
                function drawPlayer(canvasX, canvasY) {
                ctxPc.drawImage(playerChar, canvasX, canvasY)
                }
                function drawMonster(x, y) {
                    ctxPc.drawImage(monsterChar1, x, y)
                }
                const animationLoop = [0, 1, 0, 2];
                let currentLoopIndex = 0;
                let frameCount = 0;
                let currentDirection = 0;

                /*let keyPresses = {};
                window.addEventListener('keydown', keyDownListener, false);
                function keyDownListener(event) {
                    keyPresses[event.key] = true;
                }
                window.addEventListener('keyup', keyUpListener, false);
                function keyUpListener(event) {
                    keyPresses[event.key] = false;
                }
                */
                const moveSpeed = 1;
                const monsterMoveSpeed = 0.5;
                let positionX = 32;
                let positionY = 12;
                let playerUp = false;
                let playerDown = false;
                let playerLeft = false;
                let playerRight = false;
                var clippingPosY = positionY + 12;
                let monster1StartX = 5 * gameTiles;
                let monster1EndX = (4 * gameTiles) + monster1StartX;
                let monsterPosX = 5 * gameTiles
                let monsterPosY = (5 * gameTiles) - 12;
                
                
                monsterStart = true;
                monsterEnd = false;
                
                console.log(allowedPathY);
                console.log(walls);
                console.log(monster1EndX)

                
                function gameLoop() {
                    ctxPc.clearRect(0, 0, pcCanvas.width, pcCanvas.height);
                    if (playerUp == true) {
                        for (let i = 0; i < allowedPathY.length; i++) {
                            var pathX = allowedPathX[i];
                            var pathY = allowedPathY[i];
                            var path = {x: pathX, y: pathY, width: 32, height: 32}
                            if (path.x < positionX + 32 &&
                                path.x + path.width > positionX &&
                                path.y < clippingPosY + 20 &&
                                path.y + path.height > clippingPosY) {
                                positionY -= moveSpeed;
                            }
                            //positionY -= moveSpeed;
                        }
                        //positionY -= moveSpeed;
                    }
                    else if (playerDown == true) {
                        positionY += moveSpeed;
                    }
                    if (playerLeft == true) {
                        positionX -= moveSpeed;
                    }
                    else if (playerRight == true) {
                        positionX += moveSpeed;
                    }
                    if (monsterPosX == monster1StartX) {
                        monsterStart = true;
                    }
                    else if (monsterPosX == monster1EndX) {
                        monsterStart = false;
                        monsterEnd = true;
                    }
                    monsterWalk(monsterStart, monsterEnd);
                    drawPlayer(positionX, positionY);
                    drawMonster(monsterPosX, monsterPosY)
                    window.requestAnimationFrame(gameLoop);
                    //console.log(positionX, positionY);
                }
                gameLoop();
                


                function monsterWalk(monsterStart, monsterEnd) {
                    
                    if (monsterStart) {
                        monsterPosX += monsterMoveSpeed;
                    }
                    else if (monsterEnd) {
                        monsterPosX -= monsterMoveSpeed;
                    }
                }
            //}
            


        </script>
    </body>
</html>